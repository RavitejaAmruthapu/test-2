<style>
  #byte_content {
    margin: 5px 0;
    max-height: 100px;
    overflow-y: auto;
    overflow-x: hidden;
  }
  #byte_range { margin-top: 5px; }
</style>

<text>Select a file to read deployment config: </text><input type="file" id="files" name="file" /><br><br>Upload File to read config's: 
<span class="readBytesButtons">
  <button>Upload</button>
</span>
<p class="readConfigButtons" id="demo"></p>
<p id="config"></p>
<script>
  function readBlob() {
    var files = document.getElementById('files').files;
    if (!files.length) {
      alert('Please select a file!');
      return;
    }
    var file = files[0];
    var reader = new FileReader();

    // If we use onloadend, we need to check the readyState.
    reader.onloadend = function(evt) {
      if (evt.target.readyState == FileReader.DONE) { // DONE == 2
        //document.getElementById('demo').innerHTML = evt.target.result.replace(/(?:\n)/g, '<br>');
        var lines = evt.target.result.split(/\r\n|\n/);
        const epmty_lines = [];
        var j = 1;
        var i=0;
        for(var line = 2; line <= lines.length-1; line++){
        //var empty = ''
        if (lines[line].replace(/\s/g, '') == '') { 
             //empty = 'Empty line';
             epmty_lines[i] = line;
             i++
        }
        //console.log(line+1 + " --> "+ lines[line]+empty);
        //empty =''
        }
        //console.log("length of empty lines array is "+epmty_lines.length);
        var st_line = 0;
        var ed_line = 0;
        //var txt="<span class=\"readConfigButtons\">";
        var txt="config's: ";
        for(var e_line = 0; e_line <= epmty_lines.length-1; e_line++){
            //console.log(epmty_lines[e_line]+" Empty line")
            if (epmty_lines[e_line+1]-epmty_lines[e_line]>1) {
                //console.log("config "+ j);
                st_line = parseInt(epmty_lines[e_line])+1;
                ed_line = parseInt(epmty_lines[e_line+1])-1;
                txt = txt + "<button id=\"config"+j+"\" data-startLine=\""+ st_line +"\" data-endLine=\""+ ed_line +"\">config"+j+"<\/button>  ";
                j++;
            }
            //console.log(epmty_lines[e_line]+" Empty line")        
        }
        //txt = txt + "<\/span>";
        //alert(txt);
        document.getElementById('demo').innerHTML = txt;
      }
    };
    reader.readAsText(file, "UTF-8");
  }
  
  document.querySelector('.readBytesButtons').addEventListener('click', function(evt) {
    if (evt.target.tagName.toLowerCase() == 'button') {
      readBlob();
    }
  }, false);

  function readConfig(opt_startLine, opt_endLine, config_name) {

    var config_files = document.getElementById('files').files;
    var config_file = config_files[0];
    var start_line = parseInt(opt_startLine);
    //alert("start_line is :"+opt_startLine);
    //alert("end_line is :"+opt_endLine);
    var end_line = parseInt(opt_endLine);
    var config_reader = new FileReader();
    // If we use onloadend, we need to check the readyState.
    config_reader.onloadend = function(evt1) {
      if (evt1.target.readyState == FileReader.DONE) { // DONE == 2
        //document.getElementById('config').innerHTML = evt1.target.result.replace(/(?:\n)/g, '<br>');
        var config_lines = evt1.target.result.split(/\r\n|\n/);
        var config_content = "You have clicked on <b>"+config_name+"</b>. So Config content is below<br><br>	";
        for(var line = start_line; line <= end_line; line++){
           config_content = config_content + config_lines[line] +"<br>";
           //console.log(line + " --> "+ config_lines[line]);
        }
        //alert(config_content);
        document.getElementById('config').innerHTML = config_content;
        }
    };
    //var blob = file.slice(start, stop + 1);
    //reader.readAsBinaryString(blob);
    config_reader.readAsText(config_file, "UTF-8");
  }
  document.querySelector('.readConfigButtons').addEventListener('click', function(evt1) {
    if (evt1.target.tagName.toLowerCase() == 'button') {
      var startLine = evt1.target.getAttribute('data-startLine');
      var endLine = evt1.target.getAttribute('data-endLine');
      //alert("You have clicked on "+evt1.target.getAttribute('id'));
      readConfig(startLine, endLine, evt1.target.getAttribute('id'));
    }
  }, false);
</script>
